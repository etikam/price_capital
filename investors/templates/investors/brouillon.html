{% extends 'investors/investment_base.html' %}
{% load static %}
{% block main_content %}
<div class="tab-pane fade show active" id="investment-details">
  <h2 class="mb-4 text-center fs-1">
    <i class="fas fa-info-circle"></i> Détails de l'Investissement
  </h2>

  <!-- Bouton Retour -->
  <div class="text-start mb-4">
    <a href="{% url 'investor:investment-dashboard' %}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Retour au tableau de bord
    </a>
  </div>

  <!-- Actions et Solde Accumulé -->
  <div class="row mb-4">
    <!-- Solde Accumulé -->
    <div class="col-12 col-md-4 mb-3">
      <div class="card border-warning shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-piggy-bank fa-3x text-warning mb-3"></i>
          <h5 class="card-title">Solde Accumulé</h5>
          <h2 class="card-text">{{ investissement.gains|floatformat:2|default:"-" }} {{ investissement.currency|default:"GNF" }}</h2>
        </div>
      </div>
    </div>

    <!-- Retirer mes Intérêts -->
    <div class="col-12 col-md-4 mb-3">
      <div class="card border-danger shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-wallet fa-3x text-danger mb-3"></i>
          <h5 class="card-title">Retirer mes Intérêts</h5>
          <a href="#" class="btn btn-outline-danger btn-lg mt-2" aria-label="Retirer mes Intérêts">
            <i class="fas fa-wallet"></i> Retirer
          </a>
        </div>
      </div>
    </div>

    <!-- Réinvestir -->
    <div class="col-12 col-md-4 mb-3">
      <div class="card border-success shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-redo fa-3x text-success mb-3"></i>
          <h5 class="card-title">Réinvestir</h5>
          <a href="#" class="btn btn-outline-success btn-lg mt-2" aria-label="Réinvestir">
            <i class="fas fa-redo"></i> Réinvestir
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Informations principales sur le projet -->
  <div class="card mb-4 shadow-lg border-0">
    <div class="card-body p-4">
      <div class="row align-items-center">
        <!-- Image du projet -->
        <div class="col-12 col-md-3 text-center mb-4 mb-md-0">
          <div class="bg-light rounded-circle p-3 d-inline-block">
            {% if investissement.project.image %}
            <img src="{{ investissement.project.image.url }}" alt="Image du projet" class="img-fluid rounded-circle" style="width: 120px; height: 120px;">
            {% else %}
            <img src="{% static 'img/default_project.jpg' %}" alt="Image par défaut" class="img-fluid rounded-circle" style="width: 120px; height: 120px;">
            {% endif %}
          </div>
        </div>

        <!-- Détails du projet -->
        <div class="col-12 col-md-9">
          <h3 class="mb-3 text-primary">{{ investissement.project.title }}</h3>
          <div class="row">
            <!-- Catégorie -->
            <div class="col-12 col-md-6 mb-2">
              <p class="text-muted mb-1">
                <i class="fas fa-tag text-secondary me-2"></i>
                <strong>Catégorie :</strong> {{ investissement.project.category.name|default:"Non défini" }}
              </p>
            </div>
            <!-- Date de début -->
            <div class="col-12 col-md-6 mb-2">
              <p class="text-muted mb-1">
                <i class="fas fa-calendar-check text-secondary me-2"></i>
                <strong>Publié Depuis :</strong> {{ investissement.project.updated_at|date:"d M Y"|default:"-" }}
              </p>
            </div>
            <!-- Date de fin -->
            <div class="col-12 col-md-6 mb-2">
              <p class="text-muted mb-1">
                <i class="fas fa-calendar-times text-secondary me-2"></i>
                <strong>Date de fin :</strong> {{ investissement.project.end_date|date:"d M Y"|default:"-" }}
              </p>
            </div>
            <!-- Statut du projet -->
            <div class="col-12 col-md-6 mb-2">
              <p class="text-muted mb-1">
                <i class="fas fa-info-circle text-secondary me-2"></i>
                <strong>Statut :</strong> {{ investissement.project.status|default:"-" }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Graphique d'évolution des gains -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="card-title mb-0 text-white">
            <i class="fas fa-chart-line"></i>
            Évolution des Gains
          </h5>
        </div>
        <div class="card-body">
          <canvas id="gainEvolutionChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts pour les graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Évolution des Gains
  const gainEvolutionCtx = document.getElementById('gainEvolutionChart').getContext('2d');
  const gainEvolutionChart = new Chart(gainEvolutionCtx, {
    type: 'line',
    data: {
      labels: {{ gain_evolution_labels|safe }}, // Semaines
      datasets: [{
        label: 'Gains Hebdomadaires (GNF)',
        data: {{ gain_evolution_data|safe }}, // Montants des gains
        borderColor: '#28a745',
        backgroundColor: 'rgba(40, 167, 69, 0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom'
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Semaine'
          }
        },
        y: {
          title: {
            display: true,
            text: 'Montant (GNF)'
          },
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}