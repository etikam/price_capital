{% extends 'investors/investment_base.html' %}
{% load static %}
{% block main_content %}
<div class="tab-pane fade show active" id="investment-details">
  <h2 class="mb-4 text-center fs-1">
    <i class="fas fa-info-circle"></i> Détails de l'Investissement:
  </h2>
   <h3 class="text-center text-primary"> Type: {{investissement.project.project.project_type}}</h3>

  <!-- Bouton Retour -->
  <div class="text-start mb-4">
    <a href="{% url 'investor:investment-dashboard' %}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Retour au tableau de bord
    </a>
  </div>

  <!-- Statistiques clés -->
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card border-primary shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-coins fa-3x text-primary mb-3"></i>
          <h5 class="card-title">Montant Investi</h5>
          <h2 class="card-text">{{ investissement.amount|floatformat:2 }} {{ investissement.currency }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card border-info shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-percentage fa-3x text-info mb-3"></i>
          <h5 class="card-title">Interet du projet</h5>
          <h2 class="card-text">{{ investissement.project.gains|floatformat:2 }} {{investissement.project.currency}}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card border-success shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
          <h5 class="card-title">Mon Interet</h5>
          <h2 class="card-text">{{ investissement.gains|floatformat:2 }} {{ investissement.currency }}</h2>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card border-info shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-percentage fa-3x text-info mb-3"></i>
          <h5 class="card-title">Mon Pourcentage</h5>
          <h2 class="card-text">{{ investissement.percentage_on_goal|floatformat:2 }}%</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Graphique d'évolution des gains -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white">
      <h5 class="card-title mb-0">
        <i class="fas fa-chart-line"></i> Évolution des Gains
      </h5>
    </div>
    <div class="card-body chart-container"> <!-- Ajoutez la classe chart-container ici -->
      <canvas id="gainEvolutionChart"></canvas>
    </div>
  </div>

  <!-- Informations principales sur le projet -->
  <h1 class="text-center text-primary">Informations Initiales</h1>
  <div class="card mb-4 shadow-lg border-0">
    <div class="card-body p-4">
      <div class="row align-items-center">
        <!-- Image du projet -->
        <div class="col-md-3 text-center mb-4 mb-md-0">
          <div class="bg-light rounded-circle p-3 shadow-sm d-inline-block">
            {% if investissement.project.image %}
            <img src="{{ investissement.project.image.url }}" alt="Image du projet" class="img-fluid rounded-circle border border-primary" style="width: 120px; height: 120px;">
            {% else %}
            <img src="{% static 'img/default_project.jpg' %}" alt="Image par défaut" class="img-fluid rounded-circle border border-secondary" style="width: 120px; height: 120px;">
            {% endif %}
          </div>
        </div>
        <!-- Détails -->
        <div class="col-md-9">
          <h3 class="mb-3 text-primary fw-bold">
            <i class="fas fa-folder-open me-2"></i>{{ investissement.project.title }}
          </h3>
          <div class="row">
            <!-- Catégorie -->
            <div class="col-md-6 mb-3">
              <p class="mb-1">
                <span class="badge bg-secondary"><i class="fas fa-tag me-1"></i> Catégorie</span>
              </p>
              <p class="text-muted mb-0">{{ investissement.project.category.name|default:"Non défini" }}</p>
            </div>
            <!-- Objectif -->
            <div class="col-md-6 mb-3">
              <p class="mb-1">
                <span class="badge bg-info"><i class="fas fa-bullseye me-1"></i> Objectif</span>
              </p>
              <p class="text-muted mb-0">{{ investissement.project.goal|floatformat:2 }} {{ investissement.project.currency }}</p>
            </div>
            <!-- Montant investi -->
            <div class="col-md-6 mb-3">
              <p class="mb-1">
                <span class="badge bg-success"><i class="fas fa-wallet me-1"></i> Montant Investi</span>
              </p>
              <p class="text-muted mb-0">{{ investissement.amount|floatformat:2 }} {{ investissement.currency }}</p>
            </div>
            <!-- Pourcentage -->
            <div class="col-md-6 mb-3">
              <p class="mb-1">
                <span class="badge bg-warning text-dark"><i class="fas fa-percent me-1"></i> Mon Pourcentage</span>
              </p>
              <p class="text-muted mb-0">{{ investissement.percentage_on_goal|floatformat:2 }}%</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script pour les graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Évolution des Gains
  const gainEvolutionCtx = document.getElementById('gainEvolutionChart').getContext('2d');
  const gainEvolutionChart = new Chart(gainEvolutionCtx, {
    type: 'line',
    data: {
      labels: {{ gain_evolution_labels|safe }}, // Semaines
      datasets: [{
        label: 'Gains Hebdomadaires (GNF)',
        data: {{ gain_evolution_data|safe }}, // Montants des gains
        borderColor: '#28a745',
        backgroundColor: 'rgba(40, 167, 69, 0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false, // Désactive le maintien du ratio d'aspect
      plugins: {
        legend: {
          display: true,
          position: 'bottom'
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Semaine'
          }
        },
        y: {
          title: {
            display: true,
            text: 'Montant (GNF)'
          },
          beginAtZero: true
        }
      }
    }
  });
</script>

<!-- Styles pour ajuster la hauteur du graphique -->
<style>
  .chart-container {
    height: 400px; /* Ajustez cette valeur selon vos besoins */
  }
</style>
{% endblock %}